<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI - Learning AI</title>
  <link rel="stylesheet" href="css/Learning_AI_Styles.css" />
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.1.1/dist/tesseract.min.js"></script>
</head>

<body>
  <header>
    <h1>Learning AI</h1>
    <nav>
      <a href="index.html" class="active">AI</a>
      <a href="Learning_AI_Notes.html">Notes</a>
      <a href="Learning_AI_Questions.html">Questions</a>
      <a href="Learning_AI_Settings.html">Settings</a>
    </nav>
  </header>

  <main>
    <section class="input-section">
      <textarea id="user-input" placeholder="Type your question or upload a file or image..."></textarea>
      <input type="file" id="file-upload" accept=".txt,.pdf,.docx,.pptx,.md,image/*" multiple />
      <div id="preview-container"></div>
      <button id="ask-button">Ask AI</button>
    </section>

    <section class="output-section">
      <div id="response">Your response will appear here...</div>
    </section>
  </main>

  <script>
    const askButton = document.getElementById("ask-button");
    const userInput = document.getElementById("user-input");
    const fileUpload = document.getElementById("file-upload");
    const responseDiv = document.getElementById("response");
    const previewContainer = document.getElementById("preview-container");

    async function handleImage(file) {
      const image = document.createElement("img");
      image.src = URL.createObjectURL(file);
      image.style.maxWidth = "200px";
      image.style.margin = "10px";
      previewContainer.appendChild(image);

      const result = await Tesseract.recognize(file, "eng");
      userInput.value += "\n" + result.data.text;
    }

    async function handleFileUpload(files) {
      previewContainer.innerHTML = "";
      for (const file of files) {
        if (file.type.startsWith("image/")) {
          await handleImage(file);
        } else {
          alert("Currently only image-based input supports processing. Please upload an image file.");
        }
      }
    }

    fileUpload.addEventListener("change", async (e) => {
      await handleFileUpload(e.target.files);
    });

    document.body.addEventListener("dragover", (e) => {
      e.preventDefault();
      e.dataTransfer.dropEffect = "copy";
    });

    document.body.addEventListener("drop", async (e) => {
      e.preventDefault();
      await handleFileUpload(e.dataTransfer.files);
    });

    askButton.addEventListener("click", async () => {
      const text = userInput.value.trim();
      if (!text) {
        alert("Please enter a question or upload a file.");
        return;
      }

      responseDiv.innerHTML = "Processing...";

      const response = await fetch("https://api.groq.com/openai/v1/chat/completions", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": "Bearer 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"
        },
        body: JSON.stringify({
          model: "mixtral-8x7b-32768",
          messages: [
            { role: "system", content: "You are a helpful AI assistant." },
            { role: "user", content: text }
          ]
        })
      });

      const data = await response.json();
      const aiMessage = data.choices[0].message.content;

      responseDiv.innerHTML = aiMessage;
      previewContainer.innerHTML = "";
      fileUpload.value = "";
    });
  </script>
</body>

</html>

<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI - Learning AI</title>
  <link rel="stylesheet" href="css/Learning_AI_Styles.css" />
</head>

<body>
  <header>
    <h1>Learning AI</h1>
    <nav>
      <a href="index.html" class="active">AI</a>
      <a href="Learning_AI_Notes.html">Notes</a>
      <a href="Learning_AI_Questions.html">Questions</a>
      <a href="Learning_AI_Settings.html">Settings</a>
    </nav>
  </header>

  <main>
    <section class="input-section">
      <textarea id="user-input" placeholder="Type your question or upload an image..."></textarea>
      <input type="file" id="file-upload" accept="image/*" multiple />
      <div id="preview-container"></div>
      <button id="ask-button">Ask AI</button>
    </section>

    <section class="output-section">
      <div id="response">Your response will appear here...</div>
    </section>
  </main>

  <script>
    const askButton = document.getElementById("ask-button");
    const userInput = document.getElementById("user-input");
    const fileUpload = document.getElementById("file-upload");
    const responseDiv = document.getElementById("response");
    const previewContainer = document.getElementById("preview-container");

    let uploadedImageDataUrl = null;

    async function handleImage(file) {
      const reader = new FileReader();
      reader.onload = () => {
        uploadedImageDataUrl = reader.result;

        const image = document.createElement("img");
        image.src = uploadedImageDataUrl;
        image.style.maxWidth = "200px";
        image.style.margin = "10px";
        previewContainer.appendChild(image);
      };
      reader.readAsDataURL(file);
    }

    fileUpload.addEventListener("change", async (e) => {
      previewContainer.innerHTML = "";
      const files = e.target.files;
      if (files.length > 0) await handleImage(files[0]);
    });

    document.body.addEventListener("dragover", (e) => {
      e.preventDefault();
      e.dataTransfer.dropEffect = "copy";
    });

    document.body.addEventListener("drop", async (e) => {
      e.preventDefault();
      previewContainer.innerHTML = "";
      const files = e.dataTransfer.files;
      if (files.length > 0) await handleImage(files[0]);
    });

    askButton.addEventListener("click", async () => {
      const promptText = userInput.value.trim();
      if (!promptText && !uploadedImageDataUrl) {
        alert("Please enter a question or upload an image.");
        return;
      }

      responseDiv.innerHTML = "Processing...";

      const response = await fetch("https://api-inference.huggingface.co/models/llava-hf/llava-1.5-7b-hf", {
        method: "POST",
        headers: {
          "Authorization": "Bearer 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",
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          inputs: {
            image: uploadedImageDataUrl,
            question: promptText || "Whatâ€™s in this image?"
          }
        })
      });

      const result = await response.json();
      responseDiv.innerHTML = result.generated_text || "No response generated.";

      uploadedImageDataUrl = null;
      fileUpload.value = "";
      previewContainer.innerHTML = "";
    });
  </script>
</body>

</html>
